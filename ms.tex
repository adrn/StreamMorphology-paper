%\documentclass{emulateapj}
\documentclass[letterpaper,12pt,preprint]{aastex}

% packages
\usepackage{amssymb,amsmath,amsbsy}
\usepackage{forest}

% commands
\newcommand{\given}{\,|\,}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\transpose}[1]{{#1}^{\mathsf{T}}}
\newcommand{\inverse}[1]{{#1}^{-1}}
\newcommand{\msun}{\mathrm{M}_\odot}
\newcommand{\bs}[1]{\boldsymbol{#1}}

\begin{document}

\title{Tidal streams in triaxial systems}
\author{Adrian M. Price-Whelan\altaffilmark{\colum,\adrn},
	    Kathryn V. Johnston\altaffilmark{\colum},
	    Monica Valluri\altaffilmark{\mich}}

% Affiliations
\newcommand{\colum}{1}
\newcommand{\adrn}{2}
\newcommand{\mich}{3}
\altaffiltext{\colum}{Department of Astronomy, 
		              Columbia University, 
		              550 W 120th St., 
		              New York, NY 10027, USA}
\altaffiltext{\adrn}{To whom correspondence should be addressed: adrn@astro.columbia.edu}
\altaffiltext{\mich}{ }

\begin{abstract}

Tidal streams form from the steady disruption of stellar systems
orbiting within the gravitational field of some parent galaxy. Many
streams and debris structures have been discovered in the halo of the
Milky Way and have been used to model the potential of the Galaxy. 
However, few of these models have yet explored the properties of
tidal debris in triaxial potentials.
The existence of a variety of orbits, resonances, and chaotic regions in such potentials 
suggest that the morphologies and dispersal timescales of
debris could differ significantly from the simpler spherical and oblate cases.
In this work we use a series of N-body simulations of stellar systems over a range 
of masses of disruption in triaxial potentials to understand the influence of the nature 
and types of orbits on debris morphologies.
Our results suggest that the mere existence of the multitude of thin streams
already known to orbit the Milky Way provides significant constraints on the
classes of triaxial potentials that provide a good representation for its dark matter halo.

\end{abstract}

\keywords{
}

%\begin{figure*}[!h]
%\begin{center}
%\includegraphics[width=\textwidth]{PATH}
%\caption{ CAPTION }\label{fig:FIGNAME}
%\end{center}
%\end{figure*}

\section{Introduction}\label{sec:introduction}

Adding third degree of freedom opens up many new orbits / resonances / etc. -- Valluri and Merritt work...

The halos of galaxies are filled with substructure...
As a satellite galaxy or globular cluster orbits within a parent galaxy, its mass is eroded due to the tidal forces of the host galaxy. For (typically) many orbits, these tidally stripped stars remain spatially coherent.
Of particular interest are cold, young dynamical structures --- ``tidal streams'' -- which provide useful information about the mass distributions at large distances in the galaxies within which they orbit. [At these distances, disk / classic baryonic components can't help you, mostly dark matter]
The formation and morphology of tidal streams has been studied extensively in a variety of assumed potential forms. [Stream formation in oblate, spherical potentials, action-angle, etc.]

For an integrable Hamiltonian, $H$, with $N$ degrees of freedom (d.o.f.), the equations of motion are most simply expressed in angle-action coordinates. In these coordinates, the actions, $J_n$, are integrals of the motion, and the conjugate angle variables, $\theta_n$, increase linearly with time
\begin{align}
	J_n &= {\rm const.}\\
	\dot{J}_n &= -\frac{\partial H}{\partial \theta_n} = 0\\
	\theta_n(t) &= \Omega_n t + \theta_n(0)\\
	\dot{\theta}_n &= \frac{\partial H}{\partial J_n} = \Omega_n(J_1,...,J_n)
\end{align}
where $n=1,2,...N$, and $\Omega_n$ are the fundamental frequencies of the orbit. Owing to the involutive property of the actions and the periodic nature of the angle variables, the topology of angle-action space is equivalent to that of the surface of an $N$-dimensional torus, and thus orbits are often referred to in terms of \emph{orbital tori}; each set of actions, $(J_1,J_2,...J_N)$, uniquely determine the torus associated with a given orbit.

If galactic halos are triaxial, their gravitational potentials will almost certainly not be globally integrable. For a given halo, if the potential is close to integrable such that the Hamiltonian can be written in terms of a small perturbation, $\epsilon$, away from some integrable Hamiltonian, $H_0$,
\begin{equation}
	H(\bs{\theta}, \bs{J}) = H_0(\bs{J}) + \epsilon H_1(\bs{\theta}, \bs{J})
\end{equation}
then a large number of regular orbits will survive the perturbation (e.g., the KAM theorem; cite Arnold)\footnote{3-vectors are represented with bold symbols}. The tori that survive will in general by separated by regions of irregular or chaotic motion, and thus any transformations to angle-action coordinates can only be defined locally. The types of motion generic to typical triaxial systems can be split into several sub-categories (summarized in Figure~\ref{fig:orbit-tree}). Regular motion can be classified by the number of resonance relations it obeys \citep[e.g.,][]{valluri98}: \emph{quasi-periodic} orbits obey no resonance relations, \emph{uni-resonant} orbits obey a single relation of the form $\bs{m}\cdot\bs{\Omega}=0$, and \emph{bi-resonant} orbits obey two resonance relations, $\bs{m}\cdot\bs{\Omega}=0$ and $\bs{n}\cdot\bs{\Omega}=0$, where $\bs{m}$ and $\bs{n}$ are integer vectors.

\begin{figure*}[!h]
\begin{center}
\includegraphics[width=0.5\textwidth]{figures/orbit-tree.pdf}
\caption{} \label{fig:orbit-tree}
\end{center}
\end{figure*}

For small perturbations, quasi-periodic, resonant, and periodic orbits all survive. As the strength of the perturbation increases, the tori associated with quasi-periodic motion 

the (bold symbols represent 3-vectors)


\section{Numerical methods}

\subsection{Numerical estimation of fundamental frequencies}

\subsection{Particle balls}

\section{Experiments}

\subsection{Potential choice}

\subsection{Frequency map}

\subsection{Morphology}

\subsection{Morphology}



\section{Outline}
\begin{itemize}
\item Start by choosing a potential and generating a frequency map for grids of loop orbits in this potential. We will use two potentials: a triaxial, NFW halo and a three-component sum of a triaxial NFW halo + disk + bulge. We will use the loop orbits to analyze properties of tidal streams along different orbits in these potentials.
\item Similar to Valluri \& Merritt (1998), we'll generate initial conditions in the $x-z$ plane with $v_x = v_z = y=0$. We'll use fixed energies (from pre-chosen energy shells) to get $v_y$. 
\item After classifying orbits, special regions, and frequency diffusion rates, we will pick a few representative cases and integrate balls of particles around those initial conditions forward for some integration time, $T_{\rm int}$. From this, we can hopefully get an idea of how the morphology of the resultant debris changes with frequency diffusion rate. Does the disk matter? (previous Valluri work suggests yes). What happens to debris on orbits near resonances?
\item For some of the above cases, run full N-body simulations and look at the debris properties. Are there morphological differences? (Note: can we trust SCF simulations? SCF uses Leapfrog integration, not great for orbits with diffusing frequencies...)

\end{itemize}

{\bf Note: ignore the sections below! They are just notes for myself...}

\section{Methods}\label{sec:methods}

For the debris morphology, ``progenitor'' matters, but also 2nd order potential effects e.g. hessian?

\subsection{Potential form}

\subsection{Tidal disruption in action-angle coordinates}
When a star is tidally stripped from a progenitor system, the difference in angle coordinates, relative to the progenitor, grows linearly with time according to
\begin{equation}
	\Delta\bs{\theta} = \Delta\bs{\theta}(t=0) + \Delta\bs{\Omega}t
\end{equation}
where $\Delta\bs{\theta}(t=0)$ is the initial offset (at time of stripping, $t=0$) between the star and progenitor, and $\Delta\bs{\Omega}$ is the corresponding difference in fundamental frequencies. Once a star has ``entered'' the stream, the constant offset becomes small compared to the term that depends on time, so that
\begin{equation}
	\Delta\bs{\theta} \approx \Delta\bs{\Omega}t.
\end{equation}
If the spread of actions of the progenitor is small enough --- corresponding to a mass [or mass ratio?] of XXX --- the frequency vector for a given star may be approximated by a Taylor expansion about the frequency vector of the progenitor,
\begin{equation}
	\Omega_i \approx \Omega_{0,i} + \frac{\partial^2 H}{\partial J_i J_j}\Delta J_j + \mathcal{O}(\Delta J^2)
\end{equation}
where we make use of the Einstein summation convention in the above expression. To first order in the difference in actions, the difference in frequencies between a star and the progenitor is approximated by
\begin{equation}
	\Delta\Omega_i \approx \frac{\partial^2 H}{\partial J_i J_j}\Delta J_j = D_{ij}\Delta J_j.\label{eq:deltafreq}
\end{equation}
where $D_{ij}$ is the Hessian of the potential in action-space. For a thin stream to form, the Hessian must be dominated by a single large eigenvalue, where the corresponding eigenvector determines the direction along which the debris will spread in the angles. If two or all of the largest eigenvalues are comparable in size, the debris will not form a thin stream and the observability (projected surface density) of the debris structure will be diminished. We would like to be able to predict the morphology of a debris structure formed from a disrupting progenitor on a given orbit in a specified potential using this fact.

\subsection{Numerically computing the Hessian in action-space}
The Hessian can be computed for an orbit in a given potential provided with a numerical scheme for computing the actions, angles, and frequencies of an orbit in an arbitrary potential. This is a non-trivial task, and we use a custom implementation of the method presented in \citep{sanders14} to compute these quantities. The procedure for computing the Hessian is as follows:
\begin{enumerate}
	\item numerically integrate the orbit of interest in the test potential;
	\item fit a \emph{toy potential} \citep[see][]{sanders14} to the orbit, and create a 3D grid of actions in this toy potential;
	\item transform the actions and angles of the grid from the toy potential to ordinary phase-space;
	\item integrate the grid of initial conditions in the test potential;
	\item solve for actions, angles, and frequencies of this grid;
	\item use the (now deformed) grid in action-space to linearly interpolate a regular grid about the orbit of interest;
	\item use a finite-difference scheme to compute first derivatives of the frequency vectors ($D_{ij} = \partial \Omega_i / \partial J_j$).
\end{enumerate}
Once we compute the Hessian, we may solve for the eigenvalues and eigenvectors of the matrix. 

An alternate approach uses the debris particles themselves to solve for the components of the Hessian at position (in action-space) of the progenitor orbit. Equation \ref{eq:deltafreq} demonstrates the relationship between the components of the relative frequency vector to the components of the relative action vector (through the Hessian) for a single particle. We now consider a case where we have a set of $K$ particles that we know should obey the equations
\begin{equation}
	\Delta\Omega_i^{(k)} = D_{ij}\Delta J_j^{(k)}.
\end{equation}
This is analogous to the classic problem in linear algebra of solving an overconstrained set of linear equations, $\mathbf{y} = \mathbf{A}\mathbf{x}$. Here, $\mathbf{y}$ is the length-$3K$ (column) vector of frequencies for each star, $\mathbf{x}$ is a length-9 (column) vector containing the ``unravelled'' values of the Hessian, and $\mathbf{A}$ is a $3K\times 9$ matrix containing the relative actions for all stars:
\begin{align}
	\mathbf{y} &= \left[ \begin{array}{c} 
					\Delta\Omega_1^{(1)} \\ \Delta\Omega_2^{(1)} \\ \Delta\Omega_3^{(1)} \\ \vdots \\ 
					\Delta\Omega_1^{(K)} \\ \Delta\Omega_2^{(K)} \\ \Delta\Omega_3^{(K)}
				\end{array} \right]\\
	\mathbf{A} &= \begin{bmatrix} 
					\Delta J_1^{(1)} & \Delta J_2^{(1)} & \Delta J_3^{(1)} & 0 & 0 & 0 & 0 & 0 & 0  \\
					0 & 0 & 0 & \Delta J_1^{(1)} & \Delta J_2^{(1)} & \Delta J_3^{(1)} & 0 & 0 & 0  \\
					0 & 0 & 0 & 0 & 0 & 0 & \Delta J_1^{(1)} & \Delta J_2^{(1)} & \Delta J_3^{(1)}  \\
					&&&&\vdots \\
					\Delta J_1^{(K)} & \Delta J_2^{(K)} & \Delta J_3^{(K)} & 0 & 0 & 0 & 0 & 0 & 0  \\
					0 & 0 & 0 & \Delta J_1^{(K)} & \Delta J_2^{(K)} & \Delta J_3^{(K)} & 0 & 0 & 0  \\
					0 & 0 & 0 & 0 & 0 & 0 & \Delta J_1^{(K)} & \Delta J_2^{(K)} & \Delta J_3^{(K)}  \\
			       \end{bmatrix}\\
	\mathbf{x} &= \left[ \begin{array}{c} D_{11} \\ D_{12} \\ \vdots \\ D_{33} \end{array} \right].
\end{align}
The parameter vector, $\mathbf{x}$, is found trivially with ordinary least squares.

% \begin{bmatrix} xz & xw \\ yz & yw \end{bmatrix}

\section{Experiments}\label{sec:experiments}

\subsection{Comparing Hessian solutions}


\section{Discussion}\label{sec:discussion}

\acknowledgements
APW is supported by a National Science Foundation Graduate Research Fellowship under Grant No.\ 11-44155. 
This research made use of Astropy, a community-developed core \texttt{Python} package for Astronomy \citep{astropy13}.
This work additionally relied on Columbia University's \emph{Hotfoot} and \emph{Yeti} compute clusters, and we acknowledge the Columbia HPC support staff for assistance. \\

\bibliographystyle{apj}
\bibliography{refs}

\end{document}
